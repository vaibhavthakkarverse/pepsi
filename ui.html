<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pepsi Order</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <style>
        *,body,html{scroll-behavior:smooth;line-height:normal;margin:0;padding:0;font-family:"Roboto Condensed",arial,sans-serif;font-optical-sizing:auto;font-style:normal;font-size:14px;color:#1C1C1C;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        html{overflow-y:scroll;font-size:100%;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}
        a,abbr,acronym,address,blockquote,button,caption,cite,code,dd,del,dfn,dl,dt,em,fieldset,figcaption,figure,form,h1,h2,h3,h4,h5,h6,img,label,legend,li,ol,p,pre,q,s,samp,small,strike,strong,sub,sup,table,tbody,td,tfoot,th,thead,tr,tt,ul,var{margin:0;padding:0;border:none}
        blockquote:after,blockquote:before,q:after,q:before{content:""}
        li,ol,ul{list-style:none;}audio,canvas,video{display:inline-block}
        img{border:none}
        a{outline:0}
        a,article,aside,details,figcaption,figure,footer,header,hgroup,nav,section,img{display:block}
        a,a:active,a:hover,a:link,a:visited{text-decoration:none}
        .dn{display:none;}
        .db{display:block;}
        .lhs{float:left;}.rhs{float:right;}
        /***** clearfix *****/
        .clearfix:after{content:" ";display:block;clear:both;line-height:0;height:0;}
        html[xmlns] .clearfix{display:block}*html .clearfix{height:1%;}

        /***** header *****/
        header{padding:10px;position:fixed;width:100%;box-shadow:0px 4px 2px #e5e5e5;z-index:9;background:#fff;}
        header .lhs a{display:block;}
        header .lhs a img{display:block;height:40px;width:auto;}
        header .rhs{display:flex;align-items:center;height:40px;}
        header .rhs h1{font-size:16px;font-weight:600;text-transform:uppercase;padding-top:12px}

        /***** items *****/
        .item_warp{padding-top:60px;}
        .item_warp .item{padding:0 20px 20px 20px;}
        .item_warp .item hgroup{padding:5px;margin:5px 0;}
        .item_warp .item hgroup h2{font-weight:700;font-size:20px;text-transform:uppercase;padding-bottom:5px;position:relative;}
        .item_warp .item hgroup h2 span{padding:2px;background:#f8e2a0;position:absolute;top:3px;right:0;font-size:12px;font-weight:600;}
        .item_warp .item hgroup h2 span em{font-size:12px;}

        .item_warp .item hgroup ul li.avl{font-weight:600;}
        .item_warp .item hgroup ul li{float:left;padding-right:5px;color:#797979;}
        .item_warp .item hgroup ul li.avl::after,.item_warp .item hgroup ul li:last-child::after{content: ""}
        .item_warp .item hgroup ul li::after{content: " . "}

        .item_warp .item .card{border:1px solid #cdcdcd;}
        .item_warp .item .card figure{padding:10px;}
        .item_warp .item .card figure img{min-width:100%;max-height:270px;height:270px;width:auto;display:block;margin:0 auto 10px auto;max-width:100%;}
        .item_warp .item .card figure figcaption ul li section{padding-bottom:30px;}
        .item_warp .item .card figure figcaption ul li h3{padding-bottom:15px;font-size:16px;}
        .item_warp .item .card figure figcaption ul li h3 .price{font-weight:500;font-size:14px;color:#ff4444;padding-left:5px;display:inline-block;}
        .item_warp .item .card figure figcaption ul li .item_count{display:flex;justify-content:space-between;align-items:center;width:100%;padding-bottom:12px;}
        .item_warp .item .card figure figcaption ul li .item_count .num_input{display:flex;align-items:center;gap:5px;}    
        .item_warp .item .card figure figcaption ul li .item_count .num_input button{width:26px;height:26px;font-size:20px;font-weight:bold;border:none;background-color:#000000;color:white;border-radius:50%;cursor:pointer;transition:0.3s;}
        .item_warp .item .card figure figcaption ul li .item_count .num_input button:hover{background-color:#0056b3;}
        .item_warp .item .card figure figcaption ul li .item_count .num_input button:disabled {opacity:0.5;cursor:not-allowed;background-color:#cdcdcd;}
        .item_warp .item .card figure figcaption ul li .item_count .num_input input{width:60px;height:30px;text-align:center;font-size:18px;border:1px solid #000000;border-radius:8px;outline:none;}
        .item_warp .item .card figure figcaption ul li .item_count .num_input input[type="number"]::-webkit-inner-spin-button,.item_warp .item .card figure figcaption ul li .item_count .num_input input[type="number"]::-webkit-outer-spin-button {-webkit-appearance:none;margin:0;}
        .item_warp .item .card figure figcaption ul li .item_count .ch_bx_warp{display:flex;align-items:center;gap:10px;font-size: 18px;cursor:pointer;}
        .item_warp .item .card figure figcaption ul li .item_count .ch_bx_warp input[type="checkbox"]{display:none;}
        .item_warp .item .card figure figcaption ul li .item_count .cst_chkbx{width:24px;height:24px;border:2px solid gray;display: flex;align-items:center;justify-content: center;border-radius:4px;transition:0.3s;font-size: 18px;font-weight:bold;}
        .item_warp .item .card figure figcaption ul li .item_count .ch_bx_warp input[type="checkbox"]:checked + .cst_chkbx{background-color:rgb(4, 4, 4);border-color:rgb(0, 0, 0);color:white;}
        .item_warp .item .card figure figcaption ul li .item_count .ch_bx_warp input[type="checkbox"]:checked + .cst_chkbx::after{content: "âœ”";}

        /***** footer *****/
        footer a.btn{position:fixed;bottom:0;left:0;width:100%;padding:10px 0;z-index:9;background:#676767;color:#9d9d9d;text-align:center;font-size:20px;text-transform:uppercase;font-weight:300;transition:0.3s;}
        footer a.btn.active{background:#015893;color:#fff;}

        /***** slider *****/
        .slider-container{position:relative;width:100%;max-width:600px;overflow:hidden;margin:auto;}
        .slider{display:flex;width:100%;transition:transform 0.5s ease-in-out;}
        .slider img{width:100%;height:300px;object-fit:contain;flex-shrink:0;}
        .dots{text-align:center;margin:10px 0 20px 0;}
        .dots span{display:inline-block;width:12px;height:12px;margin:5px;background:#bbb;border-radius:50%;cursor:pointer;transition:opacity 0.3s ease-in-out;}
        .dots .active{opacity:1;background: #333;}
    </style>
    <script>
        let products = [];
        let productGroups = {};

        async function loadProducts() {
            try {
                const response = await fetch('https://vaibhavthakkarverse.github.io/pepsi/products.csv');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvText = await response.text();
                const rows = csvText.split('\n').slice(1);
                
                products = rows
                    .filter(row => row.trim())
                    .map(row => {
                        const [id, name, size, group_id, box_price, piece_price, image_url, fixed_loose_qty, display_name] = row.split(',').map(field => field.trim());
                        return {
                            id,
                            name,
                            size,
                            group_id,
                            box_price: parseInt(box_price),
                            piece_price: parseInt(piece_price),
                            image_url,
                            fixed_loose_qty: parseInt(fixed_loose_qty),
                            display_name: display_name || group_id
                        };
                    })
                    .sort((a, b) => {
                        // First sort by group_id
                        const groupCompare = a.group_id.localeCompare(b.group_id);
                        if (groupCompare !== 0) return groupCompare;
                        // If same group, sort by size
                        return a.size.localeCompare(b.size);
                    });

                if (products.length === 0) {
                    throw new Error('No products found in the CSV file');
                }

                products.forEach(product => {
                    if (!productGroups[product.group_id]) {
                        productGroups[product.group_id] = {
                            name: product.display_name,
                            products: [],
                            images: new Set() // Use Set to store unique image URLs
                        };
                    }
                    productGroups[product.group_id].products.push(product);
                    if (product.image_url) {
                        productGroups[product.group_id].images.add(product.image_url);
                    }
                });

                renderProducts();
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('error').innerHTML = `
                    Error loading products: ${error.message}<br>
                    Please make sure products.csv is in the same directory as this HTML file.
                `;
            }
        }

        function renderProducts() {
            const productsContainer = document.querySelector('.item_warp');
            productsContainer.innerHTML = '';

            Object.entries(productGroups).forEach(([group_id, group]) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'item';

                // Create header group
                const headerGroup = document.createElement('hgroup');
                headerGroup.innerHTML = `
                    <h2>${group.name}</h2>
                   
                `;
                itemElement.appendChild(headerGroup);

                // Create card
                const card = document.createElement('div');
                card.className = 'card';

                // Create figure
                const figure = document.createElement('figure');

                // Create slider container
                const sliderContainer = document.createElement('div');
                sliderContainer.className = 'slider-container';

                // Create slider
                const slider = document.createElement('div');
                slider.className = 'slider';

                // Add images to slider
                group.images.forEach(imageUrl => {
                    const img = document.createElement('img');
                    img.src = imageUrl;
                    img.alt = group.name;
                    slider.appendChild(img);
                });

                // Create dots
                const dots = document.createElement('div');
                dots.className = 'dots';

                sliderContainer.appendChild(slider);
                sliderContainer.appendChild(dots);
                figure.appendChild(sliderContainer);

                // Create figcaption
                const figcaption = document.createElement('figcaption');
                const ul = document.createElement('ul');
                const li = document.createElement('li');

                // Add product sections
                group.products.forEach(product => {
                    const section = document.createElement('section');
                    section.innerHTML = `
                        <h3>${product.size} <span class="price">â‚¹${product.box_price}/box, â‚¹${product.piece_price}/piece</span></h3>
                        <div class="item_count">
                            <p>No. of boxes</p>
                            <div class="num_input">
                                <button type="button" onclick="changeQuantity(this, -1)">-</button>
                                <input type="number" name="quantity" value="0" min="0" max="1000" id="${product.id}_box" onchange="validateQuantity(this)">
                                <button type="button" onclick="changeQuantity(this, 1)">+</button>
                            </div>
                        </div>
                        <div class="item_count">
                            <p>Loose (${product.fixed_loose_qty})</p>
                            <label class="ch_bx_warp">
                                <input type="checkbox" id="${product.id}_loose" data-fixed-qty="${product.fixed_loose_qty}">
                                <span class="cst_chkbx"></span>
                            </label>
                        </div>
                    `;
                    li.appendChild(section);
                });

                ul.appendChild(li);
                figcaption.appendChild(ul);
                figure.appendChild(figcaption);
                card.appendChild(figure);
                itemElement.appendChild(card);
                productsContainer.appendChild(itemElement);
            });

            // Initialize slider
            initializeSlider();
        }

        function changeQuantity(button, change) {
            const input = button.parentElement.querySelector('input');
            const currentValue = parseInt(input.value) || 0;
            const newValue = currentValue + change;
            if (newValue >= 0 && newValue <= 1000) {
                input.value = newValue;
                updateSubmitButton();
            }
        }

        function validateQuantity(input) {
            let value = parseInt(input.value) || 0;
            if (value < 0) value = 0;
            if (value > 1000) value = 1000;
            input.value = value;
            updateSubmitButton();
        }

        function updateSubmitButton() {
            const submitButton = document.querySelector('.btn');
            const hasBoxes = Array.from(document.querySelectorAll('input[type="number"]')).some(input => parseInt(input.value) > 0);
            const hasLoose = Array.from(document.querySelectorAll('input[type="checkbox"]')).some(checkbox => checkbox.checked);
            
            if (hasBoxes || hasLoose) {
                submitButton.classList.add('active');
            } else {
                submitButton.classList.remove('active');
            }
        }

        // Add event listener for checkbox changes
        document.addEventListener('change', function(e) {
            if (e.target.type === 'checkbox') {
                updateSubmitButton();
            }
        });

        function initializeSlider() {
            const sliders = document.querySelectorAll('.slider');
            sliders.forEach((slider, sliderIndex) => {
                const images = slider.querySelectorAll('img');
                const dotsContainer = slider.nextElementSibling;
                let index = 0;
                const totalImages = images.length;

                if (totalImages <= 1) return; // Skip if there's only one or no image

                // Create navigation dots for each slider
                images.forEach((_, i) => {
                    const dot = document.createElement('span');
                    dot.setAttribute('data-index', i);
                    dot.addEventListener('click', () => {
                        index = i;
                        updateSlider();
                    });
                    dotsContainer.appendChild(dot);
                });

                function updateSlider() {
                    slider.style.transform = `translateX(-${index * 100}%)`;
                    dotsContainer.querySelectorAll('span').forEach(dot => dot.classList.remove('active'));
                    dotsContainer.querySelectorAll('span')[index].classList.add('active');
                }

                function autoSlide() {
                    index = (index + 1) % totalImages;
                    updateSlider();
                }

                let sliderInterval = setInterval(autoSlide, 3000);

                // Initialize first dot as active
                updateSlider();
            });
        }

        function showSlide(index) {
            const clickedDot = event.target;
            const slider = clickedDot.closest('.slider-container').querySelector('.slider');
            const dotsContainer = clickedDot.parentElement;
            const dots = dotsContainer.querySelectorAll('span');
            
            dots.forEach(dot => dot.classList.remove('active'));
            dots[index].classList.add('active');
            slider.style.transform = `translateX(-${index * 100}%)`;
        }

        function calculateTotal(product, boxQty, looseQty) {
            return (boxQty * product.box_price) + (looseQty * product.piece_price);
        }

        function sendOrder() {
            let orderText = "Pepsi Order:\n";
            let totalAmount = 0;

            products.forEach(product => {
                const boxQty = parseInt(document.getElementById(`${product.id}_box`).value) || 0;
                const looseCheckbox = document.getElementById(`${product.id}_loose`);
                const looseQty = looseCheckbox.checked ? product.fixed_loose_qty : 0;

                if (boxQty > 0 || looseQty > 0) {
                    const productTotal = calculateTotal(product, boxQty, looseQty);
                    orderText += `${product.name} ${product.size}:`;
                    if (boxQty > 0) orderText += `\n- Boxes: ${boxQty}`;
                    if (looseQty > 0) orderText += `\n- Loose: ${looseQty}`;
                    orderText += `\n- Amount: â‚¹${productTotal}\n\n`;
                    totalAmount += productTotal;
                }
            });

            if (totalAmount === 0) {
                alert("Please select at least one product.");
                return;
            }

            orderText += `Total Amount: â‚¹${totalAmount}`;
            let whatsappUrl = `https://wa.me/919998984223?text=${encodeURIComponent(orderText)}`;
            window.open(whatsappUrl, "_blank");
        }

        // Load products when page loads
        document.addEventListener('DOMContentLoaded', loadProducts);
    </script>
</head>
<body>
    <header class="clearfix">
        <div class="lhs">
            <a href="javaScript:void(0);">
                <img src="https://vaibhavthakkarverse.github.io/pepsi/images/nita_logo.png" alt="Nita Sales" />
            </a>
        </div>
        <div class="rhs">
            <h1>nita sales nadiad - online</h1>
        </div>
    </header>
    <section class="item_warp">
        <!-- Dynamic content will be loaded here -->
    </section>
    <footer>
        <a href="javaScript:void(0);" class="btn" onclick="sendOrder()">Submit Order</a>
    </footer>
</body>
</html>
